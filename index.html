<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lead AI - Master AI Before AI Masters You</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* --- CORE STYLES --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d122c;
            color: #e2e8f0;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }

        /* Glow Effects */
        body::before, body::after {
            content: '';
            position: fixed;
            border-radius: 50%;
            background-color: #FD3A4A;
            filter: blur(80px);
            z-index: -15;
            opacity: 0.3;
            pointer-events: none;
        }

        body::before {
            width: 350px;
            height: 350px;
            top: -120px;
            right: -120px;
        }

        body::after {
            width: 300px;
            height: 300px;
            bottom: -150px;
            left: -150px;
        }

        /* Typography & Components */
        .hero-gradient-text {
            background: linear-gradient(to right, #3b82f6, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .portfolio-hero-name {
            color: #ffffff;
            font-size: 3rem;
            font-weight: 900;
            line-height: 1;
            letter-spacing: -0.05em;
        }
        @media (min-width: 768px) {
            .portfolio-hero-name { font-size: 5rem; }
        }

        .portfolio-card {
            background-color: rgba(18, 26, 58, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .portfolio-card::before, .portfolio-card::after {
            content: '';
            position: absolute;
            width: 200px;
            height: 200px;
            background-image: radial-gradient(circle, rgba(255, 255, 255, 0.08) 1px, transparent 1.5px);
            background-size: 16px 16px;
            opacity: 0.8;
            z-index: -1;
            pointer-events: none;
        }
        .portfolio-card::before { top: 20px; left: 20px; }
        .portfolio-card::after { bottom: 20px; right: 20px; }

        .card-bg {
            background-color: rgba(17, 24, 39, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .card-bg:hover {
            border-color: rgba(253, 58, 74, 0.5);
            box-shadow: 0 0 20px rgba(253, 58, 74, 0.2);
        }
        
        #animation-container {
            width: 100%;
            height: 100%;
            min-height: 400px;
            position: relative;
        }
        #animation-container canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* Forms */
        .form-input, .form-textarea, .form-select {
            background-color: rgba(30, 41, 59, 0.7);
            border: 1px solid #334155;
            color: #e2e8f0;
            transition: all 0.2s ease-in-out;
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
        }
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #FD3A4A;
            box-shadow: 0 0 0 2px rgba(253, 58, 74, 0.4);
        }
        
        /* Buttons */
        .btn {
             color: #fff;
             font-weight: 600;
             padding: 0.75rem 1.5rem;
             border-radius: 0.5rem;
             transition: all 0.3s ease;
             display: inline-flex;
             align-items: center;
             justify-content: center;
             gap: 0.5rem;
             border: 1px solid transparent;
             cursor: pointer;
        }
        .btn-primary {
             background-color: #FD3A4A;
             border-color: #FD3A4A;
        }
        .btn-primary:hover {
            background-color: #e62b3a;
            border-color: #e62b3a;
        }
        .btn-primary:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        .btn-secondary {
            background-color: transparent;
            border-color: #4b5563;
        }
        .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: #6b7280;
        }

        .section-heading {
            font-size: 2rem;
            font-weight: 700;
            color: #f1f5f9;
            margin-bottom: 2.5rem;
            text-align: left;
            position: relative;
            padding-bottom: 0.5rem;
        }
        .section-heading::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 3px;
            background-color: #FD3A4A;
            border-radius: 2px;
        }

        /* Modal & Notification */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px);
            display: flex; align-items: center; justify-content: center; z-index: 100;
        }
        .notification-toast {
            position: fixed; bottom: 2rem; right: 2rem; z-index: 110;
            padding: 1rem 1.5rem; border-radius: 0.5rem; display: flex; align-items: center; gap: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
    
    <!-- 
        IMPORT MAP:
        Using unpkg for all three.js dependencies ensures version compatibility (v0.160.0).
        This prevents the 'material.onBuild is not a function' error caused by version mismatches.
    -->
    <script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
    "@supabase/supabase-js": "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "three/": "https://aistudiocdn.com/three@^0.181.2/",
    "vite": "https://aistudiocdn.com/vite@^7.2.4",
    "@vitejs/plugin-react": "https://aistudiocdn.com/@vitejs/plugin-react@^5.1.1"
  }
}
</script>
</head>
<body class="antialiased">
    <!-- Mount Points -->
    <div id="app"></div>
    <div id="modal-root"></div>
    <div id="notification-root"></div>

    <!-- Logic -->
    <script type="module">
        import { createClient } from '@supabase/supabase-js';
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        // --- CONFIGURATION ---
        const SUPABASE_URL = 'https://svnyshizkoaqzchkyoyq.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN2bnlzaGl6a29hcXpjaGt5b3lxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4MDIzNjEsImV4cCI6MjA3OTM3ODM2MX0.v8bggKp_4Aiiw-sfV5QVVOINMDzPazfVzCIynnTC9Ss';
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // --- STATE ---
        const state = {
            user: null,
            users: [],
            route: window.location.hash || '#',
            loading: true,
            modal: { isOpen: false, view: 'login' },
            portfolioEditing: false,
            tempUser: null, // used during editing
            threeApp: {
                renderer: null,
                frameId: null,
                resizeHandler: null
            }
        };

        // --- UTILS ---
        const showNotification = (message, type = 'success') => {
            const root = document.getElementById('notification-root');
            const el = document.createElement('div');
            el.className = `notification-toast border backdrop-blur-md ${type === 'success' ? 'bg-green-900/80 border-green-500 text-green-100' : 'bg-red-900/80 border-red-500 text-red-100'}`;
            el.innerHTML = `
                ${type === 'success' ? '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>' : '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'}
                <span class="font-medium">${message}</span>
                <button class="ml-4 opacity-70 hover:opacity-100 text-2xl leading-none" onclick="this.parentElement.remove()">&times;</button>
            `;
            root.appendChild(el);
            setTimeout(() => el.remove(), 4000);
        };

        const hydrateUser = (dbUser) => {
            const defaultPortfolio = {
                tagline: "AI Enthusiast & Lifelong Learner",
                about_me: `Hello, I'm ${dbUser.username}.`,
                profile_image_url: '',
                contact: { email: '', phone: '', location: '', linkedin: '', github: '', website: '' },
                skills_list: [],
                projects: [],
                experience_list: [],
                education_list: [],
            };
            const p = dbUser.portfolio || {};
            return {
                id: dbUser.id,
                username: dbUser.username || 'Unknown',
                email: dbUser.email || '',
                portfolio: {
                    ...defaultPortfolio,
                    ...p,
                    contact: { ...defaultPortfolio.contact, ...(p.contact || {}) },
                    skills_list: Array.isArray(p.skills_list) ? p.skills_list : [],
                    projects: Array.isArray(p.projects) ? p.projects : [],
                    experience_list: Array.isArray(p.experience_list) ? p.experience_list : [],
                    education_list: Array.isArray(p.education_list) ? p.education_list : [],
                    profile_image_url: p.profile_image_url || `https://i.pravatar.cc/150?u=${dbUser.id}`,
                }
            };
        };

        // --- ICONS ---
        const Icons = {
             Github: `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12c0 4.418 2.865 8.168 6.839 9.49.5.092.682-.217.682-.482 0-.237-.009-.868-.014-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.031-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.378.203 2.398.1 2.651.64.7 1.03 1.595 1.03 2.688 0 3.848-2.338 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.001 10.001 0 0022 12c0-5.523-4.477-10-10-10z" clip-rule="evenodd" /></svg>`,
             Linkedin: `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" /></svg>`,
             Website: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>`,
             Tool: `<svg class="w-12 h-12 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>`,
             Breakthrough: `<svg class="w-12 h-12 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>`,
             Trenches: `<svg class="w-12 h-12 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>`,
             Qna: `<svg class="w-12 h-12 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>`,
             Trash: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>`,
             Plus: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>`
        };

        // --- INITIALIZATION ---
        async function initApp() {
            // Check LocalStorage Session
            const stored = localStorage.getItem('lead_ai_user');
            if (stored) {
                try {
                    const parsed = JSON.parse(stored);
                    // Validate with DB
                    const { data, error } = await supabase.from('profiles').select('id, username, email, portfolio').eq('id', parsed.id).single();
                    if (data && !error) state.user = hydrateUser(data);
                    else localStorage.removeItem('lead_ai_user');
                } catch (e) { localStorage.removeItem('lead_ai_user'); }
            }
            
            await fetchCommunity();
            state.loading = false;
            render();
        }

        async function fetchCommunity() {
            const { data } = await supabase.from('profiles').select('id, username, email, portfolio');
            if (data) state.users = data.map(hydrateUser);
        }

        // --- ROUTING ---
        window.addEventListener('hashchange', () => {
            state.route = window.location.hash;
            render();
        });
        const navigate = (hash) => { window.location.hash = hash; };

        // --- ACTIONS (Global for Inline HTML) ---
        window.actions = {
            openLogin: () => { state.modal = { isOpen: true, view: 'login' }; render(); },
            openRegister: () => { state.modal = { isOpen: true, view: 'register' }; render(); },
            closeModal: () => { state.modal = { isOpen: false, view: 'login' }; render(); },
            switchAuth: () => { state.modal.view = state.modal.view === 'login' ? 'register' : 'login'; render(); },
            
            logout: () => {
                localStorage.removeItem('lead_ai_user');
                state.user = null;
                showNotification("Logged out");
                navigate('#');
            },

            loginSubmit: async (e) => {
                e.preventDefault();
                const form = e.target;
                const email = form.email.value;
                const password = form.password.value;
                const btn = form.querySelector('button');
                const oldText = btn.innerHTML;
                btn.innerText = "Processing..."; btn.disabled = true;

                const { data, error } = await supabase.from('profiles').select('*').eq('email', email).eq('pass', password);
                
                if (error) {
                    showNotification("Login error occurred", 'error');
                } else if (!data || data.length === 0) {
                    showNotification("User not registered. Please check email and password or sign up.", 'error');
                } else {
                    const user = hydrateUser(data[0]);
                    state.user = user;
                    localStorage.setItem('lead_ai_user', JSON.stringify(user));
                    state.modal.isOpen = false;
                    showNotification("Logged in successfully");
                    render();
                }
                btn.innerHTML = oldText; btn.disabled = false;
            },

            registerSubmit: async (e) => {
                e.preventDefault();
                const form = e.target;
                const username = form.username.value;
                const email = form.email.value;
                const password = form.password.value;

                if(password.length < 6) { showNotification("Password must be at least 6 characters", "error"); return; }

                const btn = form.querySelector('button');
                const oldText = btn.innerHTML;
                btn.innerText = "Processing..."; btn.disabled = true;

                const { data: exists } = await supabase.from('profiles').select('email').eq('email', email);
                if (exists && exists.length > 0) {
                    showNotification("User already exists", "error");
                    btn.innerHTML = oldText; btn.disabled = false;
                    return;
                }

                const newId = crypto.randomUUID();
                const newPortfolio = {
                    tagline: "AI Enthusiast", about_me: `Hello, I'm ${username}.`,
                    profile_image_url: `https://i.pravatar.cc/150?u=${newId}`,
                    contact: { email }, skills_list: [], projects: [], experience_list: [], education_list: []
                };

                const { error } = await supabase.from('profiles').insert([{
                    id: newId, username, email, pass: password, portfolio: newPortfolio
                }]);

                if (error) {
                    showNotification(error.message, 'error');
                } else {
                    const newUser = hydrateUser({ id: newId, username, email, portfolio: newPortfolio });
                    state.user = newUser;
                    localStorage.setItem('lead_ai_user', JSON.stringify(newUser));
                    state.modal.isOpen = false;
                    showNotification("Welcome aboard!");
                    await fetchCommunity();
                    navigate(`#/profile/${username}`);
                }
                btn.innerHTML = oldText; btn.disabled = false;
            },

            // --- PORTFOLIO EDITING ---
            toggleEdit: (isEditing) => {
                state.portfolioEditing = isEditing;
                // Deep clone current user to temp for editing
                if (isEditing) state.tempUser = JSON.parse(JSON.stringify(state.user));
                else state.tempUser = null;
                render();
            },

            saveProfile: async () => {
                const btn = document.getElementById('save-btn');
                if(btn) btn.innerText = "Saving...";
                
                // Gather data manually from DOM inputs
                const p = state.tempUser.portfolio;
                
                p.tagline = document.getElementById('in-tagline').value;
                p.about_me = document.getElementById('in-about').value;
                p.contact.email = document.getElementById('in-email').value;
                p.contact.phone = document.getElementById('in-phone').value;
                p.contact.location = document.getElementById('in-location').value;
                p.contact.github = document.getElementById('in-github').value;
                p.contact.linkedin = document.getElementById('in-linkedin').value;
                p.contact.website = document.getElementById('in-website').value;
                p.experience_list = document.getElementById('in-exp').value.split('\n').filter(x=>x.trim());
                p.education_list = document.getElementById('in-edu').value.split('\n').filter(x=>x.trim());

                // Projects (Titles/Links/Desc are bound via onchange in HTML generation, but images are tough. 
                // Since we updated state.tempUser on change events below, we can trust state.tempUser)

                const { error } = await supabase.from('profiles').update({
                    portfolio: p, username: state.tempUser.username
                }).eq('id', state.user.id);

                if (error) {
                    showNotification("Failed to save", 'error');
                    if(btn) btn.innerText = "Save Changes";
                } else {
                    state.user = JSON.parse(JSON.stringify(state.tempUser));
                    localStorage.setItem('lead_ai_user', JSON.stringify(state.user));
                    showNotification("Profile saved!");
                    state.portfolioEditing = false;
                    state.tempUser = null;
                    await fetchCommunity();
                    render();
                }
            },

            // Helper to update temp state as user types (for complex objects like arrays)
            updateTempProject: (index, field, value) => {
                if(!state.tempUser) return;
                state.tempUser.portfolio.projects[index][field] = value;
            },
            addProject: () => {
                state.tempUser.portfolio.projects.push({ title: '', description: '', link: '', imageUrl: '' });
                render();
            },
            removeProject: (index) => {
                state.tempUser.portfolio.projects.splice(index, 1);
                render();
            },
            addSkill: () => {
                const input = document.getElementById('new-skill-input');
                const val = input.value.trim();
                if(val && !state.tempUser.portfolio.skills_list.includes(val)) {
                    state.tempUser.portfolio.skills_list.push(val);
                    render();
                }
            },
            removeSkill: (val) => {
                state.tempUser.portfolio.skills_list = state.tempUser.portfolio.skills_list.filter(s => s !== val);
                render();
            },
            // Image handling needs FileReader
            handleImageUpload: (file, type, index) => {
                if(!file) return;
                const reader = new FileReader();
                reader.onloadend = () => {
                    if (type === 'profile') state.tempUser.portfolio.profile_image_url = reader.result;
                    else if (type === 'project') state.tempUser.portfolio.projects[index].imageUrl = reader.result;
                    render();
                };
                reader.readAsDataURL(file);
            }
        };

        // --- RENDER COMPONENTS ---
        const Header = () => `
            <header class="fixed top-0 left-0 right-0 z-50 bg-black/30 backdrop-blur-md border-b border-slate-800">
                <div class="container mx-auto px-6 py-4 flex justify-between items-center">
                    <a href="#" onclick="window.location.hash='#'; return false;" class="text-2xl font-bold tracking-tighter hero-gradient-text">Lead AI</a>
                    <div class="flex items-center gap-8">
                        <nav class="hidden md:flex space-x-8">
                            <a href="#mission" class="text-slate-300 hover:text-blue-400 transition-colors">Mission</a>
                            <a href="#pillars" class="text-slate-300 hover:text-blue-400 transition-colors">Pillars</a>
                            <a href="#/community" onclick="window.location.hash='#/community'; return false;" class="text-slate-300 hover:text-blue-400 transition-colors">Community</a>
                        </nav>
                        <div class="flex items-center gap-4">
                            ${state.user ? `
                                <a href="#/profile/${state.user.username}" onclick="window.location.hash='#/profile/${state.user.username}'; return false;" class="text-slate-100 font-semibold hover:text-blue-400">${state.user.username}</a>
                                <button onclick="window.actions.logout()" class="bg-slate-700 hover:bg-slate-600 text-sm text-white font-bold py-2 px-4 rounded-lg">Logout</button>
                            ` : `
                                <button onclick="window.actions.openLogin()" class="text-slate-300 hover:text-white">Login</button>
                                <button onclick="window.actions.openRegister()" class="bg-slate-100 text-slate-900 font-bold px-4 py-2 rounded-lg text-sm hover:bg-slate-200">Sign Up</button>
                            `}
                        </div>
                    </div>
                </div>
            </header>
        `;

        const Hero = () => `
            <section id="home" class="min-h-screen w-full flex items-center pt-24 md:pt-0">
                <div class="container mx-auto px-6 flex flex-col md:flex-row items-center justify-between w-full">
                    <div class="md:w-1/2 lg:w-2/5 text-center md:text-left mb-12 md:mb-0 z-10">
                        <h1 class="text-4xl md:text-6xl lg:text-7xl font-black tracking-tighter text-slate-100 mb-4">Master AI</h1>
                        <h2 class="text-4xl md:text-6xl lg:text-7xl font-black tracking-tighter hero-gradient-text mb-6">Before AI Masters You</h2>
                        <p class="max-w-xl mx-auto md:mx-0 text-lg md:text-xl text-slate-400 mb-10">Lead AI is an exclusive circle for practitioners dedicated to decoding the future of AI in real-time.</p>
                        <a href="#pillars" class="bg-slate-100 text-slate-900 font-bold px-8 py-4 rounded-lg text-lg hover:bg-slate-200 inline-block">Discover Our Pillars</a>
                    </div>
                    <div class="md:w-1/2 w-full h-[50vh] md:h-auto"><div id="animation-container"></div></div>
                </div>
            </section>
            <section id="mission" class="py-20 relative z-10"><div class="container mx-auto px-6"><div class="grid md:grid-cols-2 gap-12 items-center"><div class="card-bg p-8 rounded-2xl"><h3 class="text-3xl font-bold mb-4 text-slate-100">Our Mission</h3><p class="text-slate-300 leading-relaxed">To forge a disciplined circle of AI practitioners who decode the future in real-time.</p></div><div class="card-bg p-8 rounded-2xl"><h3 class="text-3xl font-bold mb-4 text-slate-100">Our Vision</h3><p class="text-slate-300 leading-relaxed">To become the definitive engine for AI excellence and industry-defining opportunities.</p></div></div></div></section>
            <section id="pillars" class="py-24 relative z-10"><div class="container mx-auto px-6"><div class="text-center mb-16"><h2 class="text-4xl font-bold text-slate-100">The Lead AI Advantage</h2></div><div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="card-bg p-8 rounded-2xl md:col-span-2 md:row-span-2"><div class="mb-4">${Icons.Tool}</div><h4 class="text-2xl font-bold text-slate-100 mb-2">Tool Spotlight</h4><p class="text-slate-400">Hands-on demos of cutting-edge AI tools.</p></div>
                <div class="card-bg p-8 rounded-2xl md:col-span-2"><div class="mb-4">${Icons.Breakthrough}</div><h4 class="text-2xl font-bold text-slate-100 mb-2">Breakthroughs</h4><p class="text-slate-400">Decoding foundational changes.</p></div>
                <div class="card-bg p-8 rounded-2xl md:col-span-1"><div class="mb-4">${Icons.Trenches}</div><h4 class="text-2xl font-bold text-slate-100 mb-2">In the Trenches</h4><p class="text-slate-400">Real problems, proven solutions.</p></div>
                <div class="card-bg p-8 rounded-2xl md:col-span-1"><div class="mb-4">${Icons.Qna}</div><h4 class="text-2xl font-bold text-slate-100 mb-2">Mastermind Q&A</h4><p class="text-slate-400">Unscripted, unfiltered feedback.</p></div>
            </div></div></section>
        `;

        const Community = () => `
            <section class="py-24 pt-40 min-h-screen"><div class="container mx-auto px-6"><div class="text-center mb-16"><h2 class="text-4xl font-bold text-slate-100">Our Community</h2><p class="text-slate-400 mt-4">A growing network of AI practitioners.</p></div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                ${state.users.map(u => `<a href="#/profile/${u.username}" onclick="window.location.hash='#/profile/${u.username}'; return false;" class="block card-bg text-center p-8 rounded-2xl hover:-translate-y-1 transition-transform"><img src="${u.portfolio.profile_image_url}" class="w-32 h-32 rounded-full mx-auto mb-4 border-4 border-slate-700 object-cover" /><h4 class="text-xl font-bold text-slate-100">${u.username}</h4><p class="text-blue-400 font-semibold">${u.portfolio.tagline || 'Member'}</p></a>`).join('') || '<p class="text-slate-500 text-center col-span-4">No members yet.</p>'}
            </div></div></section>
        `;

        const Portfolio = (username) => {
            const target = state.users.find(u => u.username.toLowerCase() === username.toLowerCase());
            if (!target) return `<div class="min-h-screen flex items-center justify-center text-4xl font-bold text-slate-500">User not found</div>`;
            
            const isOwner = state.user && state.user.id === target.id;
            const isEditing = isOwner && state.portfolioEditing;
            // If editing, use state.tempUser, else use target user data
            const p = isEditing ? state.tempUser.portfolio : target.portfolio;
            const name = isEditing ? state.tempUser.username : target.username;

            if (!isEditing) {
                // VIEW MODE
                return `
                <div class="pt-24 min-h-screen container mx-auto px-4 py-12">
                    ${isOwner ? `<div class="flex justify-end mb-6"><button onclick="window.actions.toggleEdit(true)" class="btn btn-primary">Edit Portfolio</button></div>` : ''}
                    <div class="portfolio-card max-w-6xl mx-auto p-8 md:p-12">
                        <div class="grid md:grid-cols-5 gap-12 items-center mb-24">
                            <div class="md:col-span-3 text-center md:text-left">
                                <p class="text-lg text-slate-300">Hello, I am</p>
                                <h1 class="portfolio-hero-name my-2">${name}</h1>
                                <p class="text-xl text-slate-400">${p.tagline}</p>
                                <div class="mt-8 flex justify-center md:justify-start gap-6">
                                    ${p.contact.github ? `<a href="https://github.com/${p.contact.github}" target="_blank" class="text-slate-400 hover:text-white">${Icons.Github}</a>` : ''}
                                    ${p.contact.linkedin ? `<a href="https://linkedin.com/in/${p.contact.linkedin}" target="_blank" class="text-slate-400 hover:text-white">${Icons.Linkedin}</a>` : ''}
                                    ${p.contact.website ? `<a href="${p.contact.website}" target="_blank" class="text-slate-400 hover:text-white">${Icons.Website}</a>` : ''}
                                </div>
                            </div>
                            <div class="md:col-span-2"><img src="${p.profile_image_url}" class="rounded-2xl w-full shadow-2xl aspect-[4/5] object-cover" /></div>
                        </div>
                        <section class="mb-24"><h2 class="section-heading">About Me</h2><p class="text-slate-300 whitespace-pre-line text-lg">${p.about_me}</p></section>
                        <section class="mb-24"><h2 class="section-heading">Skills</h2><div class="flex flex-wrap gap-3">${p.skills_list.map(s => `<span class="bg-slate-800 text-slate-300 px-4 py-2 rounded-full">${s}</span>`).join('')}</div></section>
                        <section class="mb-24"><h2 class="section-heading">Latest Projects</h2>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                                ${p.projects.map(proj => `<div class="card-bg rounded-xl overflow-hidden p-6"><img src="${proj.imageUrl || ''}" class="w-full h-40 object-cover rounded mb-4 ${!proj.imageUrl?'hidden':''}" /><h4 class="text-xl font-bold text-slate-100">${proj.title}</h4><p class="text-slate-400 mt-2">${proj.description}</p>${proj.link ? `<a href="${proj.link}" target="_blank" class="text-red-400 block mt-4">View Project &rarr;</a>` : ''}</div>`).join('')}
                            </div>
                        </section>
                        <section class="grid md:grid-cols-2 gap-10">
                            <div class="border border-slate-700 p-6 rounded"><h3 class="text-2xl font-bold mb-4">Experience</h3><ul class="list-disc list-inside text-slate-300">${p.experience_list.map(e => `<li>${e}</li>`).join('')}</ul></div>
                            <div class="border border-slate-700 p-6 rounded"><h3 class="text-2xl font-bold mb-4">Education</h3><ul class="list-disc list-inside text-slate-300">${p.education_list.map(e => `<li>${e}</li>`).join('')}</ul></div>
                        </section>
                    </div>
                </div>`;
            } else {
                // EDIT MODE
                return `
                <div class="pt-24 min-h-screen container mx-auto px-4 py-12">
                    <div class="flex justify-end gap-2 mb-6">
                        <button id="save-btn" onclick="window.actions.saveProfile()" class="btn btn-primary min-w-[120px]">Save Changes</button>
                        <button onclick="window.actions.toggleEdit(false)" class="btn btn-secondary">Cancel</button>
                    </div>
                    <div class="portfolio-card max-w-6xl mx-auto p-8">
                        <div class="mb-8"><label class="block text-slate-400 mb-1">Tagline</label><input id="in-tagline" type="text" value="${p.tagline}" class="form-input" /></div>
                        <div class="mb-8"><label class="block text-slate-400 mb-1">About Me</label><textarea id="in-about" rows="6" class="form-textarea">${p.about_me}</textarea></div>
                        <div class="mb-8"><label class="block text-slate-400 mb-1">Profile Image</label><input type="file" onchange="window.actions.handleImageUpload(this.files[0], 'profile')" class="text-slate-400"/></div>
                        
                        <div class="grid md:grid-cols-2 gap-6 mb-8">
                            <div><label class="block text-slate-400 text-sm">Email</label><input id="in-email" type="text" value="${p.contact.email}" class="form-input" /></div>
                            <div><label class="block text-slate-400 text-sm">Phone</label><input id="in-phone" type="text" value="${p.contact.phone}" class="form-input" /></div>
                            <div><label class="block text-slate-400 text-sm">Location</label><input id="in-location" type="text" value="${p.contact.location}" class="form-input" /></div>
                            <div><label class="block text-slate-400 text-sm">Github</label><input id="in-github" type="text" value="${p.contact.github}" class="form-input" /></div>
                            <div><label class="block text-slate-400 text-sm">LinkedIn</label><input id="in-linkedin" type="text" value="${p.contact.linkedin}" class="form-input" /></div>
                            <div><label class="block text-slate-400 text-sm">Website</label><input id="in-website" type="text" value="${p.contact.website}" class="form-input" /></div>
                        </div>

                        <div class="mb-8 border p-4 border-slate-700 rounded">
                            <h3 class="font-bold mb-2">Skills</h3>
                            <div class="flex gap-2 mb-2"><input id="new-skill-input" type="text" class="form-input" placeholder="New Skill"/><button onclick="window.actions.addSkill()" class="btn btn-primary py-2"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg></button></div>
                            <div class="flex flex-wrap gap-2">${p.skills_list.map(s => `<span class="bg-slate-700 px-3 py-1 rounded-full flex items-center gap-2">${s} <button onclick="window.actions.removeSkill('${s}')" class="text-red-400">&times;</button></span>`).join('')}</div>
                        </div>

                        <div class="mb-8">
                            <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-xl">Projects</h3><button onclick="window.actions.addProject()" class="btn btn-primary text-sm">Add Project</button></div>
                            <div class="space-y-6">
                                ${p.projects.map((proj, idx) => `
                                    <div class="border border-slate-700 p-4 rounded bg-slate-900/50 relative">
                                        <button onclick="window.actions.removeProject(${idx})" class="absolute top-2 right-2 text-red-500 hover:text-red-400">${Icons.Trash}</button>
                                        <div class="grid gap-3">
                                            <input type="text" placeholder="Title" class="form-input" value="${proj.title}" onchange="window.actions.updateTempProject(${idx}, 'title', this.value)"/>
                                            <textarea placeholder="Description" class="form-textarea" rows="2" onchange="window.actions.updateTempProject(${idx}, 'description', this.value)">${proj.description}</textarea>
                                            <input type="text" placeholder="Link URL" class="form-input" value="${proj.link}" onchange="window.actions.updateTempProject(${idx}, 'link', this.value)"/>
                                            <div><span class="text-sm text-slate-500">Image: </span><input type="file" onchange="window.actions.handleImageUpload(this.files[0], 'project', ${idx})" class="text-sm text-slate-400"/></div>
                                            ${proj.imageUrl ? `<img src="${proj.imageUrl}" class="h-20 object-cover w-32 rounded"/>` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div><label class="block text-slate-400 mb-1">Experience (One per line)</label><textarea id="in-exp" rows="5" class="form-textarea">${p.experience_list.join('\n')}</textarea></div>
                            <div><label class="block text-slate-400 mb-1">Education (One per line)</label><textarea id="in-edu" rows="5" class="form-textarea">${p.education_list.join('\n')}</textarea></div>
                        </div>
                    </div>
                </div>`;
            }
        };

        const Modal = () => {
            if (!state.modal.isOpen) return '';
            const isReg = state.modal.view === 'register';
            return `
            <div class="modal-overlay" onclick="window.actions.closeModal()">
                <div class="card-bg w-full max-w-md p-8 rounded-2xl border border-slate-700" onclick="event.stopPropagation()">
                    <div class="flex justify-between mb-6"><h2 class="text-3xl font-bold text-slate-100">${isReg ? 'Create Account' : 'Welcome Back'}</h2><button onclick="window.actions.closeModal()" class="text-slate-400 hover:text-white text-2xl">&times;</button></div>
                    <form onsubmit="window.actions.${isReg ? 'registerSubmit' : 'loginSubmit'}(event)">
                        ${isReg ? `<div class="mb-4"><label class="block text-slate-400 mb-1">Username</label><input name="username" type="text" class="form-input" required /></div>` : ''}
                        <div class="mb-4"><label class="block text-slate-400 mb-1">Email</label><input name="email" type="email" class="form-input" required /></div>
                        <div class="mb-4"><label class="block text-slate-400 mb-1">Password</label><input name="password" type="password" class="form-input" placeholder="${isReg?'Min 6 chars':''}" required /></div>
                        <button type="submit" class="w-full btn btn-primary">${isReg ? 'Register' : 'Login'}</button>
                    </form>
                    <div class="mt-6 text-center text-slate-400">${isReg ? 'Already have an account?' : "Don't have an account?"} <button onclick="window.actions.switchAuth()" class="text-blue-400 font-semibold ml-1">${isReg ? 'Login' : 'Sign Up'}</button></div>
                </div>
            </div>`;
        };

        // --- THREE JS ---
        function cleanupThreeJS() {
             if (state.threeApp.frameId) {
                 cancelAnimationFrame(state.threeApp.frameId);
                 state.threeApp.frameId = null;
             }
             if (state.threeApp.resizeHandler) {
                 window.removeEventListener('resize', state.threeApp.resizeHandler);
                 state.threeApp.resizeHandler = null;
             }
             if (state.threeApp.renderer) {
                 state.threeApp.renderer.domElement.remove();
                 state.threeApp.renderer.dispose();
                 state.threeApp.renderer = null;
             }
        }

        function initThreeJS() {
            cleanupThreeJS();
            const container = document.getElementById('animation-container');
            if (!container) return;

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, container.offsetWidth / container.offsetHeight, 0.1, 1000);
            camera.position.z = 15;
            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(container.offsetWidth, container.offsetHeight);
            container.appendChild(renderer.domElement);
            state.threeApp.renderer = renderer;

            const controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true; controls.autoRotate = true; controls.enableZoom = false;

            const mainGroup = new THREE.Group();
            scene.add(mainGroup);
            
            // Rings
            for (let i=0; i<15; i++) {
                const ring = new THREE.Mesh(
                    new THREE.TorusGeometry(6 + Math.random()*2, 0.02, 16, 100),
                    new THREE.MeshBasicMaterial({ color: 0x3b82f6, transparent: true, opacity: 0.1 })
                );
                ring.rotation.set(Math.random()*3, Math.random()*3, Math.random()*3);
                mainGroup.add(ring);
            }
            
            // Particles
            const pGeo = new THREE.BufferGeometry();
            const pos = [];
            for(let i=0; i<3000; i++) pos.push((Math.random()-0.5)*30, (Math.random()-0.5)*30, (Math.random()-0.5)*30);
            pGeo.setAttribute('position', new THREE.Float32BufferAttribute(pos, 3));
            mainGroup.add(new THREE.Points(pGeo, new THREE.PointsMaterial({ size: 0.05, color: 0x3b82f6, transparent: true, opacity: 0.5 })));

            // Nodes
            const nodeGeo = new THREE.SphereGeometry(0.1, 8, 8);
            const nodeMat = new THREE.MeshBasicMaterial({ color: 0x3b82f6 });
            for(let i=0; i<40; i++) {
                const mesh = new THREE.Mesh(nodeGeo, nodeMat);
                mesh.position.set((Math.random()-0.5)*10, (Math.random()-0.5)*10, (Math.random()-0.5)*10);
                mainGroup.add(mesh);
            }

            const composer = new EffectComposer(renderer);
            composer.addPass(new RenderPass(scene, camera));
            composer.addPass(new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85));

            const onResize = () => {
                if(!container) return;
                camera.aspect = container.offsetWidth / container.offsetHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.offsetWidth, container.offsetHeight);
                composer.setSize(container.offsetWidth, container.offsetHeight);
            };
            window.addEventListener('resize', onResize);
            state.threeApp.resizeHandler = onResize;

            function animate() {
                state.threeApp.frameId = requestAnimationFrame(animate);
                mainGroup.rotation.y += 0.001;
                controls.update();
                composer.render();
            }
            animate();
        }

        // --- RENDER LOOP ---
        function render() {
            const app = document.getElementById('app');
            const modalRoot = document.getElementById('modal-root');
            
            const hash = state.route.replace(/^#\/?/, '').split('/');
            const page = hash[0] || 'home';
            
            // Cleanup ThreeJS if leaving home
            if (page !== 'home') cleanupThreeJS();

            let content = '';
            if (state.loading) content = `<div class="h-screen flex items-center justify-center text-white">Loading...</div>`;
            else if (page === 'home') content = Hero();
            else if (page === 'community') content = Community();
            else if (page === 'profile') content = Portfolio(hash[1]);
            else content = Hero();

            app.innerHTML = `
                ${Header()}
                <main>${content}</main>
                <footer class="border-t border-slate-800 py-8 text-center text-slate-400 mt-12"><p>&copy; 2024 Lead AI. All rights reserved.</p></footer>
            `;
            
            modalRoot.innerHTML = Modal();

            if (page === 'home' && !state.loading) setTimeout(initThreeJS, 50);
        }

        // Start App
        initApp();
    </script>
</body>
</html>