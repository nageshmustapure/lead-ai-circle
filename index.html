<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lead AI - Master AI Before AI Masters You</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <!-- Babel for in-browser compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* --- CORE STYLES --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d122c;
            color: #e2e8f0;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }

        /* Glow Effects */
        body::before, body::after {
            content: '';
            position: fixed;
            border-radius: 50%;
            background-color: #FD3A4A;
            filter: blur(80px);
            z-index: -15;
            opacity: 0.3;
            pointer-events: none;
        }

        body::before {
            width: 350px;
            height: 350px;
            top: -120px;
            right: -120px;
        }

        body::after {
            width: 300px;
            height: 300px;
            bottom: -150px;
            left: -150px;
        }

        /* Typography & Components */
        .hero-gradient-text {
            background: linear-gradient(to right, #3b82f6, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .portfolio-hero-name {
            color: #ffffff;
            font-size: 3rem;
            font-weight: 900;
            line-height: 1;
            letter-spacing: -0.05em;
        }
        @media (min-width: 768px) {
            .portfolio-hero-name { font-size: 5rem; }
        }

        .portfolio-card {
            background-color: rgba(18, 26, 58, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .portfolio-card::before, .portfolio-card::after {
            content: '';
            position: absolute;
            width: 200px;
            height: 200px;
            background-image: radial-gradient(circle, rgba(255, 255, 255, 0.08) 1px, transparent 1.5px);
            background-size: 16px 16px;
            opacity: 0.8;
            z-index: -1;
            pointer-events: none;
        }
        .portfolio-card::before { top: 20px; left: 20px; }
        .portfolio-card::after { bottom: 20px; right: 20px; }

        .card-bg {
            background-color: rgba(17, 24, 39, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .card-bg:hover {
            border-color: rgba(253, 58, 74, 0.5);
            box-shadow: 0 0 20px rgba(253, 58, 74, 0.2);
        }
        
        #animation-container {
            width: 100%;
            height: 100%;
            min-height: 400px;
            position: relative;
        }
        #animation-container canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* Forms */
        .form-input, .form-textarea, .form-select {
            background-color: rgba(30, 41, 59, 0.7);
            border: 1px solid #334155;
            color: #e2e8f0;
            transition: all 0.2s ease-in-out;
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
        }
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #FD3A4A;
            box-shadow: 0 0 0 2px rgba(253, 58, 74, 0.4);
        }
        
        /* Buttons */
        .btn {
             color: #fff;
             font-weight: 600;
             padding: 0.75rem 1.5rem;
             border-radius: 0.5rem;
             transition: all 0.3s ease;
             display: inline-flex;
             align-items: center;
             justify-content: center;
             gap: 0.5rem;
             border: 1px solid transparent;
             cursor: pointer;
        }
        .btn-primary {
             background-color: #FD3A4A;
             border-color: #FD3A4A;
        }
        .btn-primary:hover {
            background-color: #e62b3a;
            border-color: #e62b3a;
        }
        .btn-primary:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        .btn-secondary {
            background-color: transparent;
            border-color: #4b5563;
        }
        .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: #6b7280;
        }

        .section-heading {
            font-size: 2rem;
            font-weight: 700;
            color: #f1f5f9;
            margin-bottom: 2.5rem;
            text-align: left;
            position: relative;
            padding-bottom: 0.5rem;
        }
        .section-heading::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 3px;
            background-color: #FD3A4A;
            border-radius: 2px;
        }
        
        /* Utilities */
        .cursor-wait { cursor: wait; }
    </style>
    
    <!-- Import Map for React 18 and Three.js -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "three": "https://esm.sh/three@0.160.0",
        "three/addons/": "https://esm.sh/three@0.160.0/examples/jsm/",
        "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@2.39.3"
      }
    }
    </script>
</head>
<body class="antialiased">
    <div id="root"></div>
    
    <!-- MAIN APPLICATION SCRIPT -->
    <script type="text/babel" data-type="module" data-presets="react">
        import React, { useState, useEffect, useRef, useCallback } from 'react';
        import ReactDOM from 'react-dom/client';
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
        import { createClient } from '@supabase/supabase-js';

        // --- SUPABASE CLIENT ---
        const supabaseUrl = 'https://svnyshizkoaqzchkyoyq.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN2bnlzaGl6a29hcXpjaGt5b3lxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4MDIzNjEsImV4cCI6MjA3OTM3ODM2MX0.v8bggKp_4Aiiw-sfV5QVVOINMDzPazfVzCIynnTC9Ss';
        const supabase = createClient(supabaseUrl, supabaseAnonKey);

        // --- ICONS ---
        const iconClass = "w-12 h-12 text-blue-500";

        const ToolIcon = () => (
            <svg className={iconClass} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path>
            </svg>
        );

        const BreakthroughIcon = () => (
            <svg className={iconClass} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
        );

        const TrenchesIcon = () => (
            <svg className={iconClass} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
            </svg>
        );

        const QnaIcon = () => (
            <svg className={iconClass} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
            </svg>
        );

        const GithubIcon = ({ className }) => (
            <svg className={className || "w-6 h-6"} viewBox="0 0 24 24" fill="currentColor">
                <path fillRule="evenodd" d="M12 2C6.477 2 2 6.477 2 12c0 4.418 2.865 8.168 6.839 9.49.5.092.682-.217.682-.482 0-.237-.009-.868-.014-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.031-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.378.203 2.398.1 2.651.64.7 1.03 1.595 1.03 2.688 0 3.848-2.338 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.001 10.001 0 0022 12c0-5.523-4.477-10-10-10z" clipRule="evenodd" />
            </svg>
        );

        const LinkedinIcon = ({ className }) => (
             <svg className={className || "w-6 h-6"} viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" />
            </svg>
        );

        const WebsiteIcon = ({ className }) => (
            <svg className={className || "w-6 h-6"} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
            </svg>
        );

        const EmailIcon = ({ className }) => (
            <svg className={className || "w-6 h-6"} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
            </svg>
        );

        const LocationIcon = ({ className }) => (
            <svg className={className || "w-6 h-6"} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
        );

        const PhoneIcon = ({ className }) => (
             <svg className={className || "w-6 h-6"} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
            </svg>
        );

        const TrashIcon = ({ className }) => (
            <svg className={className || "w-6 h-6"} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
        );

        const PlusIcon = ({ className }) => (
            <svg className={className || "w-6 h-6"} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
            </svg>
        );

        // --- CONSTANTS ---
        const FOUNDING_MEMBERS = [
            {
                name: "Nagesh Mustapure",
                title: "Data Scientist",
                experience: "6+ years in Data Science",
                company: "Avira Digital",
                imageUrl: "https://picsum.photos/seed/nagesh/128/128"
            },
            {
                name: "Dipak Gudal",
                title: "Data Scientist",
                experience: "4+ years of experience",
                imageUrl: "https://picsum.photos/seed/dipak/128/128"
            },
            {
                name: "Nikhil Avsula",
                title: "Software Engineer",
                experience: "3+ years of experience",
                company: "Avira Digital",
                imageUrl: "https://picsum.photos/seed/nikhil/128/128"
            },
            {
                name: "Aishwarya K.",
                title: "Data Scientist",
                experience: "5+ years of experience",
                imageUrl: "https://picsum.photos/seed/aishwarya/128/128"
            }
        ];

        const PILLARS = [
            {
                id: "spotlight",
                title: "AI Tool Spotlight",
                description: "Hands-on demos of cutting-edge AI tools. We stress-test new applications to decide if a tool is hype or a must-have.",
                icon: <ToolIcon />,
                gridClass: "md:col-span-2 md:row-span-2 flex flex-col justify-center"
            },
            {
                id: "breakthroughs",
                title: "Breakthroughs & Frameworks",
                description: "Decoding foundational changes in the AI landscape—new models, framework updates, and paradigm shifts.",
                icon: <BreakthroughIcon />,
                gridClass: "md:col-span-2"
            },
            {
                id: "trenches",
                title: "In the Trenches",
                description: "Real problems, proven solutions. Learn from a shared library of battle-tested fixes.",
                icon: <TrenchesIcon />,
                gridClass: "md:col-span-1"
            },
            {
                id: "qna",
                title: "Mastermind Q&A",
                description: "Unscripted, unfiltered, and unstuck. Get direct feedback from expert perspectives.",
                icon: <QnaIcon />,
                gridClass: "md:col-span-1"
            }
        ];

        // --- COMPONENTS ---

        // Link Component
        const Link = ({ to, children, ...props }) => {
            const handleClick = (event) => {
                event.preventDefault();
                if (to.startsWith('#/') || to === '#') {
                    window.location.hash = to;
                } else if (to.startsWith('#')) {
                    const targetId = to.substring(1);
                    const element = document.getElementById(targetId);
                    if (element) {
                        element.scrollIntoView({ behavior: 'smooth' });
                    } else {
                        window.location.hash = '#';
                        setTimeout(() => {
                            const homeElement = document.getElementById(targetId);
                            homeElement?.scrollIntoView({ behavior: 'smooth' });
                        }, 100);
                    }
                }
            };
            return <a href={to} onClick={handleClick} {...props}>{children}</a>;
        };

        // OPTIMIZED ThreeAnimation Component
        const ThreeAnimation = () => {
            const mountRef = useRef(null);

            useEffect(() => {
                if (!mountRef.current) return;

                const container = mountRef.current;
                let scene, camera, renderer, composer, controls;
                let mainGroup, nnGroup;
                let clock = new THREE.Clock();
                const allNodes = [];
                let animationFrameId;

                const init = () => {
                    scene = new THREE.Scene();
                    camera = new THREE.PerspectiveCamera(75, container.offsetWidth / container.offsetHeight, 0.1, 1000);
                    camera.position.z = 15;

                    renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                    renderer.setSize(container.offsetWidth, container.offsetHeight);
                    // OPTIMIZATION: Limit pixel ratio to 2 to prevent lag on high-res screens
                    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); 
                    container.appendChild(renderer.domElement);

                    controls = new OrbitControls(camera, renderer.domElement);
                    controls.enableDamping = true;
                    controls.dampingFactor = 0.05;
                    controls.minDistance = 8;
                    controls.maxDistance = 40;
                    controls.autoRotate = true;
                    controls.autoRotateSpeed = 0.4;
                    controls.enableZoom = false;
                    controls.enablePan = false;

                    mainGroup = new THREE.Group();
                    scene.add(mainGroup);

                    const glowColor = new THREE.Color(0x3b82f6);

                    // OPTIMIZATION: Reduced complexity of TorusGeometry
                    const ringMaterial = new THREE.MeshBasicMaterial({ color: glowColor, wireframe: true, transparent: true, opacity: 0.1 });
                    for (let i = 0; i < 15; i++) {
                        // Reduced segments from (16, 100) to (8, 40)
                        const geometry = new THREE.TorusGeometry(6 + Math.random() * 2, 0.01 + Math.random() * 0.03, 8, 40);
                        const ring = new THREE.Mesh(geometry, ringMaterial);
                        ring.rotation.set(Math.random() * Math.PI, Math.random() * Math.PI, Math.random() * Math.PI);
                        const scale = 0.9 + Math.random() * 0.2;
                        ring.scale.set(scale, scale, scale);
                        mainGroup.add(ring);
                    }

                    // OPTIMIZATION: Reduced particle count from 10,000 to 3,000
                    const particleCount = 3000; 
                    const particlesGeometry = new THREE.BufferGeometry();
                    const posArray = new Float32Array(particleCount * 3);
                    for (let i = 0; i < particleCount * 3; i++) {
                        const theta = Math.random() * 2 * Math.PI;
                        const phi = Math.acos(2 * Math.random() - 1);
                        const r = 5.5 + Math.random() * 3;
                        posArray[i * 3 + 0] = r * Math.sin(phi) * Math.cos(theta);
                        posArray[i * 3 + 1] = r * Math.sin(phi) * Math.sin(theta);
                        posArray[i * 3 + 2] = r * Math.cos(phi);
                    }
                    particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
                    const particleMaterial = new THREE.PointsMaterial({ size: 0.03, color: glowColor, transparent: true, opacity: 0.5, blending: THREE.AdditiveBlending, sizeAttenuation: true });
                    mainGroup.add(new THREE.Points(particlesGeometry, particleMaterial));

                    nnGroup = new THREE.Group();
                    mainGroup.add(nnGroup);
                    buildStaticNeuralNetwork();

                    const renderScene = new RenderPass(scene, camera);
                    const bloomPass = new UnrealBloomPass(new THREE.Vector2(container.offsetWidth, container.offsetHeight), 1.5, 0.4, 0.85);
                    bloomPass.threshold = 0;
                    bloomPass.strength = 1.6;
                    bloomPass.radius = 0.7;
                    composer = new EffectComposer(renderer);
                    composer.addPass(renderScene);
                    composer.addPass(bloomPass);

                    window.addEventListener('resize', onWindowResize, false);
                };

                const buildStaticNeuralNetwork = () => {
                    const layerDefs = [6, 8, 10, 8, 6];
                    const layerDistance = 2.0;
                    // OPTIMIZATION: Reduced sphere segments (16,16 -> 8,8)
                    const nodeGeometry = new THREE.SphereGeometry(0.1, 8, 8); 
                    const layers = [];

                    for (let i = 0; i < layerDefs.length; i++) {
                        const numNodes = layerDefs[i];
                        const layerZ = -(layerDefs.length - 1) * layerDistance / 2 + i * layerDistance;
                        const layer = { nodePositions: [] };
                        for (let j = 0; j < numNodes; j++) {
                            const angle = (j / numNodes) * Math.PI * 2;
                            const radius = 1.5 + (numNodes > 8 ? 0.8 : 0);
                            const x = Math.cos(angle) * radius;
                            const y = Math.sin(angle) * radius;
                            const nodeMaterial = new THREE.MeshBasicMaterial({ color: 0x3b82f6 });
                            const nodeMesh = new THREE.Mesh(nodeGeometry, nodeMaterial);
                            nodeMesh.position.set(x, y, layerZ);
                            allNodes.push(nodeMesh);
                            layer.nodePositions.push(nodeMesh.position);
                            nnGroup.add(nodeMesh);
                        }
                        layers.push(layer);
                    }

                    // OPTIMIZATION: Batch Line Rendering
                    // Instead of creating hundreds of separate Line objects, create one geometry with all segments.
                    const linePoints = [];
                    const lineMaterial = new THREE.LineBasicMaterial({ color: 0x3b82f6, transparent: true, opacity: 0.15, blending: THREE.AdditiveBlending });
                    
                    for (let i = 0; i < layers.length - 1; i++) {
                        for (const startPos of layers[i].nodePositions) {
                            for (const endPos of layers[i + 1].nodePositions) {
                                linePoints.push(startPos.clone());
                                linePoints.push(endPos.clone());
                            }
                        }
                    }
                    
                    const lineGeometry = new THREE.BufferGeometry().setFromPoints(linePoints);
                    const lines = new THREE.LineSegments(lineGeometry, lineMaterial);
                    nnGroup.add(lines);
                };

                const onWindowResize = () => {
                    if (!container) return;
                    camera.aspect = container.offsetWidth / container.offsetHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(container.offsetWidth, container.offsetHeight);
                    composer.setSize(container.offsetWidth, container.offsetHeight);
                };

                const animate = () => {
                    animationFrameId = requestAnimationFrame(animate);
                    const elapsedTime = clock.getElapsedTime();
                    mainGroup.rotation.y += 0.0005;
                    mainGroup.rotation.x += 0.0002;

                    // Optimization: only update colors, don't change geometry
                    allNodes.forEach((node, index) => {
                        const blink = (Math.sin(elapsedTime * 0.5 + index * 0.5) + 1) / 2;
                        const scale = 0.5 + blink * 1.2;
                        node.scale.setScalar(scale);
                        const hue = 0.6 + (Math.sin(elapsedTime * 0.3 + index * 0.4) + 1) / 2 * 0.25;
                        (node.material).color.setHSL(hue, 1.0, 0.6 + blink * 0.3);
                    });

                    controls.update();
                    composer.render();
                };

                init();
                animate();

                return () => {
                    window.removeEventListener('resize', onWindowResize);
                    cancelAnimationFrame(animationFrameId);
                    if(renderer) renderer.dispose();
                    if (container && renderer && renderer.domElement) {
                        if (container.contains(renderer.domElement)) {
                            container.removeChild(renderer.domElement);
                        }
                    }
                };
            }, []);

            return <div id="animation-container" ref={mountRef}></div>;
        };

        // AuthModal Component
        const AuthModal = ({ initialView, onClose, onRegister, onLogin }) => {
            const [view, setView] = useState(initialView);
            const [email, setEmail] = useState('');
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);
            
            // Track mounted state to avoid setting state after unmount
            const isMounted = useRef(true);
            useEffect(() => {
                return () => { isMounted.current = false; };
            }, []);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    if (view === 'register') {
                        if (!username || !email || !password) {
                            if (isMounted.current) {
                                setError('All fields are required.');
                                setLoading(false);
                            }
                            return;
                        }
                        if (password.length < 6) {
                            if (isMounted.current) {
                                setError('Password must be at least 6 characters long.');
                                setLoading(false);
                            }
                            return;
                        }
                        const result = await onRegister(username, email, password);
                        if (isMounted.current) {
                            if (!result.success) {
                                setError(result.message || "Registration failed.");
                                setLoading(false);
                            } else {
                                // Success implies unmount, so we do nothing
                            }
                        }
                    } else {
                        if (!email || !password) {
                            if (isMounted.current) {
                                setError('All fields are required.');
                                setLoading(false);
                            }
                            return;
                        }
                        const result = await onLogin(email, password);
                        if (isMounted.current) {
                            if (!result.success) {
                                setError(result.message || "Invalid credentials.");
                                setLoading(false);
                            } else {
                                // Success implies unmount
                            }
                        }
                    }
                } catch (e) {
                    if (isMounted.current) {
                        setError("An unexpected error occurred.");
                        setLoading(false);
                    }
                }
            };
            
            return (
                <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[100]" onClick={onClose}>
                    <div className="card-bg w-full max-w-md p-8 rounded-2xl border border-slate-700 shadow-2xl" onClick={(e) => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-3xl font-bold text-slate-100">
                                {view === 'register' ? 'Create Account' : 'Welcome Back'}
                            </h2>
                            <button onClick={onClose} className="text-slate-400 hover:text-white">&times;</button>
                        </div>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            {view === 'register' && (
                                <div>
                                    <label className="block text-slate-400 mb-1" htmlFor="username">Username</label>
                                    <input id="username" type="text" value={username} onChange={(e) => setUsername(e.target.value)} className="form-input" placeholder="Choose a username" />
                                </div>
                            )}
                            <div>
                                <label className="block text-slate-400 mb-1" htmlFor="email">Email</label>
                                <input id="email" type="email" value={email} onChange={(e) => setEmail(e.target.value)} className="form-input" placeholder="you@example.com" />
                            </div>
                            <div>
                                <label className="block text-slate-400 mb-1" htmlFor="password">Password</label>
                                <input id="password" type="password" value={password} onChange={(e) => setPassword(e.target.value)} className="form-input" placeholder="••••••••" />
                                {view === 'register' && <p className="text-xs text-slate-500 mt-1">Must be at least 6 characters</p>}
                            </div>
                            {error && <p className="text-red-400 text-sm bg-red-900/30 p-2 rounded border border-red-800/50">{error}</p>}
                            <button type="submit" disabled={loading} className="w-full btn-primary mt-2 disabled:opacity-50 disabled:cursor-not-allowed flex justify-center items-center">
                                {loading ? 'Processing...' : (view === 'register' ? 'Register' : 'Login')}
                            </button>
                        </form>
                        <div className="mt-6 text-center">
                            <p className="text-slate-400">
                                {view === 'register' ? 'Already have an account?' : "Don't have an account?"}
                                <button onClick={() => { setView(view === 'register' ? 'login' : 'register'); setError(''); }} className="font-semibold text-blue-400 hover:text-blue-300 ml-2">
                                    {view === 'register' ? 'Login' : 'Sign Up'}
                                </button>
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        // Header Component
        const Header = ({ currentUser, onLoginClick, onRegisterClick, onLogout }) => {
            const navLinks = [
                { href: "#mission", label: "Mission" },
                { href: "#pillars", label: "Pillars" },
                { href: "#founding-members", label: "Founders" },
                { href: "#/community", label: "Community" }
            ];

            return (
                <header className="fixed top-0 left-0 right-0 z-50 bg-black/30 backdrop-blur-md border-b border-slate-800">
                    <div className="container mx-auto px-6 py-4 flex justify-between items-center">
                        <Link to="#" className="text-2xl font-bold tracking-tighter hero-gradient-text">Lead AI</Link>
                        <div className="flex items-center gap-8">
                            <nav className="hidden md:flex space-x-8">
                                {navLinks.map((link) => (
                                    <Link key={link.href} to={link.href} className="text-slate-300 hover:text-blue-400 transition-colors duration-300">
                                        {link.label}
                                    </Link>
                                ))}
                            </nav>
                            <div className="flex items-center gap-4">
                                {currentUser ? (
                                    <>
                                        <Link to={`#/profile/${currentUser.username}`} className="text-slate-100 font-semibold hover:text-blue-400 transition-colors">
                                            {currentUser.username}
                                        </Link>
                                        <button onClick={onLogout} className="bg-slate-700 hover:bg-slate-600 text-sm text-white font-bold py-2 px-4 rounded-lg transition-colors">
                                            Logout
                                        </button>
                                    </>
                                ) : (
                                    <>
                                        <button onClick={onLoginClick} className="text-slate-300 hover:text-white transition-colors">Login</button>
                                        <button onClick={onRegisterClick} className="bg-slate-100 text-slate-900 font-bold px-4 py-2 rounded-lg text-sm hover:bg-slate-200 transition-transform duration-300 hover:scale-105">Sign Up</button>
                                    </>
                                )}
                            </div>
                        </div>
                    </div>
                </header>
            );
        };

        // Hero Component
        const Hero = () => (
            <section id="home" className="min-h-screen w-full flex items-center pt-24 md:pt-0">
                <div className="container mx-auto px-6 flex flex-col md:flex-row items-center justify-between w-full">
                    <div className="md:w-1/2 lg:w-2/5 text-center md:text-left mb-12 md:mb-0 z-10">
                        <h1 className="text-4xl md:text-6xl lg:text-7xl font-black tracking-tighter text-slate-100 mb-4">Master AI</h1>
                        <h2 className="text-4xl md:text-6xl lg:text-7xl font-black tracking-tighter hero-gradient-text mb-6">Before AI Masters You</h2>
                        <p className="max-w-xl mx-auto md:mx-0 text-lg md:text-xl text-slate-400 mb-10">
                            Lead AI is an exclusive circle for practitioners dedicated to decoding the future of AI in real-time and gaining a definitive competitive edge.
                        </p>
                        <Link to="#pillars" className="bg-slate-100 text-slate-900 font-bold px-8 py-4 rounded-lg text-lg hover:bg-slate-200 transition-transform duration-300 hover:scale-105 inline-block">
                            Discover Our Pillars
                        </Link>
                    </div>
                    <div className="md:w-1/2 w-full h-[50vh] md:h-auto">
                        <ThreeAnimation />
                    </div>
                </div>
            </section>
        );

        // Mission Component
        const Mission = () => (
            <section id="mission" className="py-20 bg-transparent relative z-10">
                <div className="container mx-auto px-6">
                    <div className="grid md:grid-cols-2 gap-12 items-center">
                        <div className="card-bg p-8 rounded-2xl">
                            <h3 className="text-3xl font-bold mb-4 text-slate-100">Our Mission</h3>
                            <p className="text-slate-300 leading-relaxed">
                                "Our mission is to forge a disciplined circle of AI practitioners who decode the future in real-time. Through a relentless weekly exchange of tactical intelligence and proven solutions, we arm our members with the clarity and advantage needed to master the AI revolution."
                            </p>
                        </div>
                        <div className="card-bg p-8 rounded-2xl">
                            <h3 className="text-3xl font-bold mb-4 text-slate-100">Our Vision</h3>
                            <p className="text-slate-300 leading-relaxed">
                                "To become the definitive engine for AI excellence. Lead AI will be the nexus where top talent, groundbreaking projects, and industry-defining opportunities converge, creating the architects who will command the next era of technological evolution."
                            </p>
                        </div>
                    </div>
                </div>
            </section>
        );

        // Pillars Component
        const Pillars = () => (
            <section id="pillars" className="py-24 relative z-10 bg-transparent">
                <div className="container mx-auto px-6">
                    <div className="text-center mb-16">
                        <h2 className="text-4xl md:text-5xl font-bold tracking-tight text-slate-100">The Lead AI Advantage</h2>
                        <p className="mt-4 text-lg text-slate-400 max-w-2xl mx-auto">
                            Our sessions are built around four powerful pillars designed to deliver actionable intelligence.
                        </p>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-4 md:grid-rows-2 gap-4">
                        {PILLARS.map((pillar) => (
                            <div key={pillar.id} className={`card-bg p-8 rounded-2xl ${pillar.gridClass}`}>
                                <div className="mb-4">{pillar.icon}</div>
                                <h4 className="text-xl md:text-2xl font-bold mb-3 text-slate-100">{pillar.title}</h4>
                                <p className="text-slate-400 text-sm md:text-base">{pillar.description}</p>
                            </div>
                        ))}
                    </div>
                </div>
            </section>
        );

        // FoundingMembers Component
        const MemberCard = ({ member }) => (
            <div className="card-bg text-center p-8 rounded-2xl">
                <img src={member.imageUrl} alt={member.name} className="w-32 h-32 rounded-full mx-auto mb-4 border-4 border-slate-700 object-cover" />
                <h4 className="text-xl font-bold text-slate-100">{member.name}</h4>
                <p className="text-blue-400 font-semibold">{member.title}</p>
                <p className="text-slate-400">{member.experience}</p>
                {member.company && <p className="text-slate-500">{member.company}</p>}
            </div>
        );

        const FoundingMembers = () => (
            <section id="founding-members" className="py-24 relative z-10 bg-transparent">
                <div className="container mx-auto px-6">
                    <div className="text-center mb-16">
                        <h2 className="text-4xl md:text-5xl font-bold tracking-tight text-slate-100">Meet Our Founding Members</h2>
                        <p className="mt-4 text-lg text-slate-400 max-w-2xl mx-auto">The core group that started the Lead AI initiative.</p>
                    </div>
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                        {FOUNDING_MEMBERS.map((member, index) => <MemberCard key={index} member={member} />)}
                    </div>
                </div>
            </section>
        );

        // CommunityPage Component
        const CommunityPage = ({ users }) => (
            <section id="community" className="py-24 pt-40 bg-transparent relative z-10 min-h-screen">
                <div className="container mx-auto px-6">
                    <div className="text-center mb-16">
                        <h2 className="text-4xl md:text-5xl font-bold tracking-tight text-slate-100">Our Community</h2>
                        <p className="mt-4 text-lg text-slate-400 max-w-2xl mx-auto">A growing network of AI practitioners and innovators. Click a profile to see their portfolio.</p>
                    </div>
                    {users.length > 0 ? (
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                            {users.map((user) => (
                                <Link key={user.id} to={`#/profile/${user.username}`} className="block card-bg text-center p-8 rounded-2xl transform hover:-translate-y-1 transition-transform duration-300">
                                    <img src={user.portfolio.profile_image_url || `https://i.pravatar.cc/150?u=${user.id}`} alt={user.username} className="w-32 h-32 rounded-full mx-auto mb-4 border-4 border-slate-700 object-cover" />
                                    <h4 className="text-xl font-bold text-slate-100">{user.username}</h4>
                                    <p className="text-blue-400 font-semibold">{user.portfolio.tagline}</p>
                                </Link>
                            ))}
                        </div>
                    ) : (
                        <div className="text-center text-slate-400"><p>No members have registered yet. Be the first to join!</p></div>
                    )}
                </div>
            </section>
        );

        // PortfolioPage Component
        const PortfolioPage = ({ user, currentUser, onUpdate }) => {
            const canEdit = currentUser?.id === user.id;
            const [isEditing, setIsEditing] = useState(false);
            const [isSaving, setIsSaving] = useState(false);
            const [editUser, setEditUser] = useState(user);
            const [copySuccess, setCopySuccess] = useState('');
            const [newSkill, setNewSkill] = useState('');
            const profileImageRef = useRef(null);
            const projectImageRefs = useRef([]);

            useEffect(() => {
                setEditUser(JSON.parse(JSON.stringify(user)));
                projectImageRefs.current = user.portfolio.projects.map(() => null);
            }, [user]);

            const handleSave = async () => {
                setIsSaving(true);
                const success = await onUpdate(user.username, { username: editUser.username, portfolio: editUser.portfolio });
                setIsSaving(false);
                if (success) {
                    setIsEditing(false);
                }
            };

            const handleFileRead = (file, callback) => {
                const reader = new FileReader();
                reader.onloadend = () => callback(reader.result);
                reader.readAsDataURL(file);
            };

            const handleProfileImageUpload = (e) => {
                if (e.target.files?.[0]) {
                    handleFileRead(e.target.files[0], (result) => {
                        setEditUser(prev => ({ ...prev, portfolio: {...prev.portfolio, profile_image_url: result }}));
                    });
                }
            };
            
            const handlePortfolioChange = (field, value) => {
                setEditUser(prev => ({ ...prev, portfolio: { ...prev.portfolio, [field]: value } }));
            };
            
            const handleContactChange = (field, value) => {
                setEditUser(prev => ({ ...prev, portfolio: { ...prev.portfolio, contact: { ...prev.portfolio.contact, [field]: value } } }));
            };

            const handleProjectImageUpload = (e, index) => {
                if (e.target.files?.[0]) {
                    handleFileRead(e.target.files[0], (result) => {
                        const newProjects = [...editUser.portfolio.projects];
                        newProjects[index].imageUrl = result;
                        setEditUser(prev => ({ ...prev, portfolio: {...prev.portfolio, projects: newProjects }}));
                    });
                }
            };

            const handleShare = async () => {
                const profileUrl = `${window.location.origin}${window.location.pathname}#/profile/${user.username}`;
                try {
                    await navigator.clipboard.writeText(profileUrl);
                    setCopySuccess('Link Copied!');
                    setTimeout(() => setCopySuccess(''), 2000);
                } catch (err) {
                    setCopySuccess('Failed to copy!');
                    setTimeout(() => setCopySuccess(''), 2000);
                }
            };
            
            const handleProjectChange = (index, field, value) => {
                const newProjects = [...editUser.portfolio.projects];
                newProjects[index] = { ...newProjects[index], [field]: value };
                setEditUser(prev => ({ ...prev, portfolio: {...prev.portfolio, projects: newProjects }}));
            };

            const handleAddProject = () => {
                setEditUser(prev => ({
                    ...prev,
                    portfolio: { ...prev.portfolio, projects: [...prev.portfolio.projects, { title: '', description: '', link: '', imageUrl: '' }] }
                }));
                projectImageRefs.current.push(null);
            };
            
            const handleRemoveProject = (index) => {
                const newProjects = editUser.portfolio.projects.filter((_, i) => i !== index);
                setEditUser(prev => ({ ...prev, portfolio: {...prev.portfolio, projects: newProjects }}));
                projectImageRefs.current.splice(index, 1);
            };

            const handleAddSkill = () => {
                if (newSkill && !editUser.portfolio.skills_list.includes(newSkill)) {
                    const newSkills = [...editUser.portfolio.skills_list, newSkill];
                    setEditUser(prev => ({...prev, portfolio: {...prev.portfolio, skills_list: newSkills }}));
                    setNewSkill('');
                }
            };

            const handleRemoveSkill = (skillToRemove) => {
                const newSkills = editUser.portfolio.skills_list.filter(s => s !== skillToRemove);
                setEditUser(prev => ({...prev, portfolio: {...prev.portfolio, skills_list: newSkills}}));
            };
            
            const renderContactIcon = (key, hrefPrefix, Icon) => {
                const value = editUser.portfolio.contact[key];
                if (!value) return null;
                const isEmail = key === 'email';
                const href = isEmail ? `mailto:${value}` : value.startsWith('http') ? value : `${hrefPrefix}${value}`;
                return (
                    <a href={href} target="_blank" rel="noopener noreferrer" title={key} className="text-slate-400 hover:text-white transition-colors">
                        <Icon className="w-6 h-6" />
                    </a>
                );
            };
            
            const renderListAsTextarea = (field, placeholder) => (
                <textarea value={editUser.portfolio[field].join('\n')} onChange={e => setEditUser(prev => ({...prev, portfolio: {...prev.portfolio, [field]: e.target.value.split('\n')}}))} className="form-textarea w-full bg-slate-900" rows={5} placeholder={placeholder} />
            );

            return (
                <div className="pt-24 min-h-screen">
                    <div className="container mx-auto px-4 sm:px-6 py-12">
                        <div className="max-w-6xl mx-auto flex justify-end gap-2 mb-6">
                            {canEdit && !isEditing && <button onClick={() => setIsEditing(true)} className="btn btn-primary">Edit Portfolio</button>}
                            {canEdit && isEditing && (
                                <>
                                    <button onClick={handleSave} disabled={isSaving} className={`btn btn-primary min-w-[140px] ${isSaving ? 'opacity-70 cursor-wait' : ''}`}>
                                        {isSaving ? 'Saving...' : 'Save Changes'}
                                    </button>
                                    <button onClick={() => { setIsEditing(false); setEditUser(JSON.parse(JSON.stringify(user))); }} disabled={isSaving} className="btn btn-secondary">Cancel</button>
                                </>
                            )}
                        </div>

                        <div className="portfolio-card max-w-6xl mx-auto p-8 md:p-12 lg:p-16 relative z-10">
                            <section className="grid md:grid-cols-5 gap-12 items-center mb-24">
                                <div className="md:col-span-3 flex flex-col justify-center text-center md:text-left">
                                    <p className="text-lg text-slate-300">Hello, I am</p>
                                    {isEditing ? (
                                        <input type="text" value={editUser.username} onChange={e => setEditUser({...editUser, username: e.target.value})} className="portfolio-hero-name my-2 bg-transparent text-white border-b-2 border-slate-700 focus:border-red-500 outline-none w-full" placeholder="Your Name" />
                                    ) : (
                                        <h1 className="portfolio-hero-name my-2">{editUser.username}</h1>
                                    )}
                                    {isEditing ? (
                                        <input type="text" value={editUser.portfolio.tagline} onChange={e => handlePortfolioChange('tagline', e.target.value)} className="form-input text-xl max-w-md mx-auto md:mx-0 mt-2 bg-slate-900/80" placeholder="Your Tagline" />
                                    ) : (
                                        <p className="text-xl text-slate-400 max-w-md mx-auto md:mx-0">{editUser.portfolio.tagline}</p>
                                    )}
                                    <div className="mt-8">
                                        <p className="text-md text-slate-300 mb-4">Find Me on</p>
                                        <div className="flex justify-center md:justify-start items-center gap-6">
                                            {renderContactIcon('github', 'https://github.com/', GithubIcon)}
                                            {renderContactIcon('linkedin', 'https://linkedin.com/in/', LinkedinIcon)}
                                            {renderContactIcon('website', '', WebsiteIcon)}
                                        </div>
                                    </div>
                                    <div className="mt-10 flex flex-col sm:flex-row gap-4 justify-center md:justify-start">
                                        <a href={`mailto:${editUser.portfolio.contact.email}`} className="btn btn-primary">Hire Me</a>
                                        <div className="relative">
                                            <button onClick={handleShare} className="btn btn-secondary w-full">Share Profile</button>
                                            {copySuccess && <span className="absolute top-full mt-2 left-1/2 -translate-x-1/2 text-sm text-green-400 bg-slate-800 px-2 py-1 rounded shadow-lg whitespace-nowrap">{copySuccess}</span>}
                                        </div>
                                    </div>
                                </div>
                                <div className="md:col-span-2 relative w-full max-w-xs mx-auto md:max-w-none">
                                    <img src={editUser.portfolio.profile_image_url} alt={user.username} className="rounded-2xl w-full h-auto object-cover shadow-2xl aspect-[4/5]" />
                                    {isEditing && (
                                        <>
                                            <input type="file" ref={profileImageRef} onChange={handleProfileImageUpload} accept="image/*" className="hidden"/>
                                            <button onClick={() => profileImageRef.current?.click()} className="absolute -bottom-3 -right-3 bg-slate-800/80 hover:bg-slate-700/80 p-3 rounded-full text-white transition-colors" aria-label="Upload profile picture">
                                                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" /></svg>
                                            </button>
                                        </>
                                    )}
                                </div>
                            </section>
                            <section className="mb-24">
                                <h2 className="section-heading">About Me</h2>
                                {isEditing ? (
                                    <textarea value={editUser.portfolio.about_me} onChange={e => handlePortfolioChange('about_me', e.target.value)} className="form-textarea w-full bg-slate-900/80" rows={6} placeholder="Tell everyone a little about yourself..."></textarea>
                                ) : (
                                    <p className="text-slate-300 leading-relaxed text-lg whitespace-pre-line">{editUser.portfolio.about_me}</p>
                                )}
                            </section>
                            {isEditing && (
                                <section className="mb-24">
                                    <h2 className="section-heading">Contact Information</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 p-6 border border-slate-700 rounded-lg">
                                        <div><label className="block text-slate-400 mb-1 text-sm">Email Address</label><input type="email" value={editUser.portfolio.contact.email} onChange={e => handleContactChange('email', e.target.value)} className="form-input" placeholder="you@example.com" /></div>
                                        <div><label className="block text-slate-400 mb-1 text-sm">Phone Number</label><input type="tel" value={editUser.portfolio.contact.phone} onChange={e => handleContactChange('phone', e.target.value)} className="form-input" placeholder="+1 (555) 123-4567" /></div>
                                        <div className="md:col-span-2"><label className="block text-slate-400 mb-1 text-sm">Location</label><input type="text" value={editUser.portfolio.contact.location} onChange={e => handleContactChange('location', e.target.value)} className="form-input" placeholder="City, Country" /></div>
                                        <div><label className="block text-slate-400 mb-1 text-sm">GitHub Username</label><input type="text" value={editUser.portfolio.contact.github} onChange={e => handleContactChange('github', e.target.value)} className="form-input" placeholder="github-username" /></div>
                                        <div><label className="block text-slate-400 mb-1 text-sm">LinkedIn Username</label><input type="text" value={editUser.portfolio.contact.linkedin} onChange={e => handleContactChange('linkedin', e.target.value)} className="form-input" placeholder="linkedin-username" /></div>
                                        <div className="md:col-span-2"><label className="block text-slate-400 mb-1 text-sm">Website URL</label><input type="url" value={editUser.portfolio.contact.website} onChange={e => handleContactChange('website', e.target.value)} className="form-input" placeholder="https://your-website.com" /></div>
                                    </div>
                                </section>
                            )}
                            <section className="mb-24">
                                <h2 className="section-heading">My Skills</h2>
                                {isEditing ? (
                                    <div className="border border-slate-700 p-6 rounded-lg">
                                        <div className="flex gap-2 mb-4">
                                            <input type="text" value={newSkill} onChange={e => setNewSkill(e.target.value)} onKeyDown={e => e.key === 'Enter' && (e.preventDefault(), handleAddSkill())} className="form-input flex-grow" placeholder="Add a skill and press Enter"/>
                                            <button onClick={handleAddSkill} className="btn btn-primary !py-2 !px-4"><PlusIcon /></button>
                                        </div>
                                        <div className="flex flex-wrap gap-3">
                                            {editUser.portfolio.skills_list.map((skill, i) => skill && (
                                                <span key={i} className="bg-slate-700 text-blue-300 px-4 py-2 rounded-full font-semibold flex items-center gap-2">
                                                    {skill}
                                                    <button onClick={() => handleRemoveSkill(skill)} className="text-slate-400 hover:text-white text-xl">&times;</button>
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                ) : (
                                    <div className="flex flex-wrap gap-3">{editUser.portfolio.skills_list.map((skill, i) => skill && <span key={i} className="bg-slate-800 text-slate-300 px-4 py-2 rounded-full font-semibold">{skill}</span>)}</div>
                                )}
                            </section>
                            <section className="mb-24">
                                <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-10">
                                    <h2 className="section-heading mt-0 mb-4 sm:mb-0">Latest Projects</h2>
                                    {isEditing && <button onClick={handleAddProject} className="btn btn-primary"><PlusIcon /> Add Project</button>}
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                                    {editUser.portfolio.projects.map((project, index) => (
                                        <div key={index} className="card-bg rounded-xl overflow-hidden group">
                                            {isEditing ? (
                                                <div className="p-6 space-y-4 relative">
                                                    <button onClick={() => handleRemoveProject(index)} className="absolute top-4 right-4 text-slate-500 hover:text-red-400 transition-colors z-10"><TrashIcon className="w-5 h-5" /></button>
                                                    {project.imageUrl && <img src={project.imageUrl} alt="preview" className="mb-2 w-full h-32 object-cover rounded"/>}
                                                    <input type="text" value={project.title} onChange={e => handleProjectChange(index, 'title', e.target.value)} className="form-input text-lg font-bold" placeholder={`Project ${index + 1} Title`} />
                                                    <textarea value={project.description} onChange={e => handleProjectChange(index, 'description', e.target.value)} className="form-textarea" rows={3} placeholder="Project description..."></textarea>
                                                    <input type="url" value={project.link} onChange={e => handleProjectChange(index, 'link', e.target.value)} className="form-input" placeholder="https://project-link.com" />
                                                    <div><label className="block text-slate-400 mb-1 text-sm">Project Image</label><input type="file" ref={el => {projectImageRefs.current[index] = el}} onChange={e => handleProjectImageUpload(e, index)} accept="image/*" className="text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-50 file:text-red-700 hover:file:bg-red-100"/></div>
                                                </div>
                                            ) : (
                                                (project.title || project.description) && (
                                                    <>
                                                        {project.imageUrl && <div className="aspect-video overflow-hidden"><img src={project.imageUrl} alt={project.title} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"/></div>}
                                                        <div className="p-6">
                                                            <h4 className="text-xl font-bold text-slate-100">{project.title}</h4>
                                                            <p className="text-slate-400 mt-2 mb-4 h-20 overflow-hidden">{project.description}</p>
                                                            {project.link && <a href={project.link} target="_blank" rel="noopener noreferrer" className="font-semibold text-red-400 hover:underline inline-block">View Project &rarr;</a>}
                                                        </div>
                                                    </>
                                                )
                                            )}
                                        </div>
                                    ))}
                                    {!isEditing && editUser.portfolio.projects.every(p => !p.title) && <p className="text-slate-400 text-center py-4 md:col-span-2 lg:col-span-3">No projects added yet.</p>}
                                </div>
                            </section>
                            <section>
                                <h2 className="section-heading">Career & Education</h2>
                                <div className="grid md:grid-cols-2 gap-10">
                                    <div className="border border-slate-700/50 p-6 rounded-lg">
                                        <h3 className="text-2xl font-bold text-slate-100 mb-4">Career Journey</h3>
                                        {isEditing ? renderListAsTextarea('experience_list', 'List experience, one per line') : <ul className="list-disc list-inside space-y-2 text-slate-300">{editUser.portfolio.experience_list.map((item, i) => item && <li key={i}>{item}</li>)}</ul>}
                                    </div>
                                    <div className="border border-slate-700/50 p-6 rounded-lg">
                                        <h3 className="text-2xl font-bold text-slate-100 mb-4">Education</h3>
                                        {isEditing ? renderListAsTextarea('education_list', 'List education, one per line') : <ul className="list-disc list-inside space-y-2 text-slate-300">{editUser.portfolio.education_list.map((item, i) => item && <li key={i}>{item}</li>)}</ul>}
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            );
        };

        // Footer Component
        const Footer = () => (
            <footer className="border-t border-slate-800 relative z-10 bg-transparent">
                <div className="container mx-auto px-6 py-8 text-center text-slate-400">
                    <p>&copy; 2024 Lead AI. All rights reserved.</p>
                    <p className="text-sm text-slate-500 mt-2">Forging the future of AI excellence.</p>
                </div>
            </footer>
        );

        // --- MAIN APP COMPONENT ---
        const Notification = ({ message, type, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 4000);
                return () => clearTimeout(timer);
            }, [onClose]);

            return (
                <div className={`fixed bottom-8 right-8 z-[100] px-6 py-4 rounded-lg shadow-2xl border backdrop-blur-md transition-all duration-300 transform translate-y-0 ${
                    type === 'success' ? 'bg-green-900/80 border-green-500 text-green-100' : 'bg-red-900/80 border-red-500 text-red-100'
                }`}>
                    <div className="flex items-center gap-3">
                        {type === 'success' ? (
                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7"></path></svg>
                        ) : (
                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        )}
                        <p className="font-medium">{message}</p>
                        <button onClick={onClose} className="ml-4 opacity-70 hover:opacity-100">&times;</button>
                    </div>
                </div>
            );
        };

        const HomePage = () => (
            <>
                <Hero />
                <Mission />
                <Pillars />
                <FoundingMembers />
            </>
        );

        const NotFoundPage = () => (
            <div className="min-h-screen flex items-center justify-center text-center">
                <div>
                    <h1 className="text-6xl font-bold hero-gradient-text">404</h1>
                    <p className="text-2xl mt-4 text-slate-300">User Not Found</p>
                    <Link to="#/community" className="mt-8 inline-block bg-slate-100 text-slate-900 font-bold px-8 py-4 rounded-lg text-lg hover:bg-slate-200 transition-transform duration-300 hover:scale-105">Back to Community</Link>
                </div>
            </div>
        );

        const hydrateUser = (dbUser) => {
            const defaultPortfolio = {
                tagline: "AI Enthusiast & Lifelong Learner",
                about_me: `Hello, I'm ${dbUser.username}.`,
                profile_image_url: '',
                contact: { email: '', phone: '', location: '', linkedin: '', github: '', website: '' },
                skills_list: [],
                projects: [],
                experience_list: [],
                education_list: [],
            };

            const portfolio = dbUser.portfolio || {};
            const hydratedPortfolio = {
                ...defaultPortfolio,
                ...portfolio,
                contact: { ...defaultPortfolio.contact, ...(portfolio.contact || {}) },
                skills_list: Array.isArray(portfolio.skills_list) ? portfolio.skills_list : [],
                projects: Array.isArray(portfolio.projects) ? portfolio.projects : [],
                experience_list: Array.isArray(portfolio.experience_list) ? portfolio.experience_list : [],
                education_list: Array.isArray(portfolio.education_list) ? portfolio.education_list : [],
                profile_image_url: portfolio.profile_image_url || `https://i.pravatar.cc/150?u=${dbUser.id}`,
            };

            return {
                id: dbUser.id,
                username: dbUser.username || 'Unknown',
                email: dbUser.email || '',
                portfolio: hydratedPortfolio,
            };
        };

        const App = () => {
            const [authModal, setAuthModal] = useState({ isOpen: false, view: 'login' });
            const [users, setUsers] = useState([]);
            const [currentUser, setCurrentUser] = useState(null);
            const [route, setRoute] = useState(window.location.hash);
            const [loading, setLoading] = useState(true);
            const [notification, setNotification] = useState(null);

            const showNotification = (message, type) => {
                setNotification({ message, type });
            };

            useEffect(() => {
                const initApp = async () => {
                    const storedUserStr = localStorage.getItem('lead_ai_user');
                    if (storedUserStr) {
                        try {
                            const storedUser = JSON.parse(storedUserStr);
                            const { data } = await supabase.from('profiles').select('id, username, email, portfolio').eq('id', storedUser.id).single();
                            if (data) {
                                setCurrentUser(hydrateUser(data));
                            } else {
                                localStorage.removeItem('lead_ai_user');
                            }
                        } catch (e) {
                            localStorage.removeItem('lead_ai_user');
                        }
                    }
                    await fetchCommunity();
                    setLoading(false);
                };
                initApp();
            }, []);

            const fetchCommunity = async () => {
                const { data, error } = await supabase.from('profiles').select('id, username, email, portfolio');
                if (!error && data) {
                    setUsers(data.map(hydrateUser));
                }
            };

            useEffect(() => {
                const handleHashChange = () => setRoute(window.location.hash);
                window.addEventListener('hashchange', handleHashChange);
                return () => window.removeEventListener('hashchange', handleHashChange);
            }, []);
            
            const handleRegister = useCallback(async (username, email, password) => {
                try {
                    const { data: existingUsers } = await supabase.from('profiles').select('email').eq('email', email);
                    if (existingUsers && existingUsers.length > 0) return { success: false, message: "User already registered. Please login." };

                    const newId = crypto.randomUUID();
                    const newPortfolio = {
                        tagline: "AI Enthusiast & Lifelong Learner",
                        about_me: `Hello, I'm ${username}. I'm new here!`,
                        profile_image_url: `https://i.pravatar.cc/150?u=${newId}`,
                        contact: { email, phone: '', location: '', linkedin: '', github: '', website: '' },
                        skills_list: ['AI', 'Machine Learning'],
                        projects: [],
                        experience_list: [],
                        education_list: [],
                    };

                    const { error: insertError } = await supabase.from('profiles').insert([{ id: newId, username: username, email: email, pass: password, portfolio: newPortfolio }]);
                    if (insertError) return { success: false, message: insertError.message };

                    const newUser = hydrateUser({ id: newId, username, email, portfolio: newPortfolio });
                    setCurrentUser(newUser);
                    localStorage.setItem('lead_ai_user', JSON.stringify(newUser));
                    setAuthModal({ isOpen: false, view: 'login' });
                    showNotification("Registration successful! Welcome aboard.", 'success');
                    await fetchCommunity();
                    setTimeout(() => { window.location.hash = `#/profile/${username}`; }, 100);
                    return { success: true };
                } catch (e) {
                    return { success: false, message: e.message || "Unexpected error occurred" };
                }
            }, []);

            const handleLogin = useCallback(async (email, password) => {
                try {
                    const { data, error } = await supabase.from('profiles').select('id, username, email, portfolio').eq('email', email).eq('pass', password);
                    if (error) return { success: false, message: error.message };
                    if (!data || data.length === 0) return { success: false, message: "User not registered. Please check email and password or sign up." };

                    const user = hydrateUser(data[0]);
                    setCurrentUser(user);
                    localStorage.setItem('lead_ai_user', JSON.stringify(user));
                    setAuthModal({ isOpen: false, view: 'login' });
                    showNotification("Successfully logged in!", 'success');
                    return { success: true };
                } catch (e) {
                    return { success: false, message: "An unexpected error occurred." };
                }
            }, []);

            const handleLogout = useCallback(async () => {
                localStorage.removeItem('lead_ai_user');
                setCurrentUser(null);
                window.location.hash = '#';
                showNotification("Logged out successfully", 'success');
            }, []);

            const handleUpdateUser = useCallback(async (currentUsername, updates) => {
                if (!currentUser) return false;
                const updatedProfile = { username: updates.username || currentUser.username, portfolio: { ...currentUser.portfolio, ...updates.portfolio } };
                const { error } = await supabase.from('profiles').update({ username: updatedProfile.username, portfolio: updatedProfile.portfolio }).eq('id', currentUser.id);

                if (error) {
                    showNotification("Failed to save changes. Please try again.", 'error');
                    return false;
                } else {
                    const newUserData = { ...currentUser, ...updatedProfile };
                    setCurrentUser(newUserData);
                    localStorage.setItem('lead_ai_user', JSON.stringify(newUserData));
                    showNotification("Profile updated successfully!", 'success');
                    await fetchCommunity();
                    if (updates.username && updates.username !== currentUsername) window.location.hash = `#/profile/${updates.username}`;
                    return true;
                }
            }, [currentUser]);

            const renderPage = () => {
                if (loading) return <div className="h-screen flex items-center justify-center text-white">Loading Community...</div>;
                const path = route.replace(/^#\/?/, '').split('/');
                const page = path[0] || 'home';
                const param = path[1];

                if (page === 'community') return <CommunityPage users={users} />;
                if (page === 'profile' && param) {
                    const userToView = users.find(u => u.username.toLowerCase() === param.toLowerCase());
                    return userToView ? <PortfolioPage user={userToView} currentUser={currentUser} onUpdate={handleUpdateUser} /> : <NotFoundPage />;
                }
                return <HomePage />;
            };

            return (
                <>
                    <div className="glow-effect"></div>
                    <Header currentUser={currentUser} onLoginClick={() => setAuthModal({isOpen: true, view: 'login'})} onRegisterClick={() => setAuthModal({isOpen: true, view: 'register'})} onLogout={handleLogout} />
                    <main>{renderPage()}</main>
                    <Footer />
                    {authModal.isOpen && <AuthModal initialView={authModal.view} onRegister={handleRegister} onLogin={handleLogin} onClose={() => setAuthModal({isOpen: false, view: 'login'})} />}
                    {notification && <Notification message={notification.message} type={notification.type} onClose={() => setNotification(null)} />}
                </>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>